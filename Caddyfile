# Caddyfile for unified-company-data-server API

{
    # Global options
    admin off
    auto_https off
}

# HTTP server (reverse proxy to NestJS API)
:80 {
    # Reverse proxy to NestJS application
    reverse_proxy api:3000 {
        # Health check
        health_uri /api/health
        health_interval 30s
        health_timeout 5s

        # Request buffering
        flush_interval -1
    }

    # Enable gzip compression
    encode gzip

    # CORS headers (if needed - adjust based on your requirements)
    header {
        # Remove server information
        -Server

        # Security headers
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"

        # CORS - adjust origins as needed
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
    }

    # Handle OPTIONS preflight requests
    @options {
        method OPTIONS
    }
    respond @options 204

    # Logging
    log {
        output stdout
        format console
    }
}
